import{r as p,k as M,o as $,g as f,i as y,n as F,p as m,L as H,M as x,N as w,C as U,a as r,c,m as k,D as j,f as A,b as a,l as _,w as B,v as L,I as C,x as O,y as G,z}from"./index-43dbed66.js";import"./day-7cfd3ec1.js";const R={key:0},Z=a("h1",{class:"text-xl"},"Event",-1),J={class:"flex flex-col gap-3"},K=["src"],Q={class:"flex flex-row gap-1"},W={key:0,class:"flex flex-col gap-1"},X={key:0,class:"flex flex-col gap-1"},ee=a("span",null,"Published",-1),te=[ee],ae={key:1,class:"flex flex-col gap-1"},ne=a("span",null,"Not published",-1),se=[ne],re={__name:"Event",props:{eventId:{type:String,required:!0},theaterGroupId:{type:String,required:!0}},setup(I){const u=I,t=p(null),b=p(!0),s=M(),v=p(null),o=p(null);$(async()=>{try{const{data:e}=await f("/events/"+u.eventId);t.value=e}catch{s.error("something went wrong")}finally{b.value=!1}});const D=y(()=>({}).VITE_API_URL+t.value.contentUrl),P=F({name:m().min(3).max(255).required(),date:H().required(),price:x().min(0).max(200).required(),location:m().required(),description:m().max(2e3).required(),video:m().matches(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$|^$/,"The url is not a vid youtube url"),capacity:x().min(1).max(1e3).required()}),S=[{label:"Name",name:"name",as:"input",type:"text"},{label:"Date",name:"date",as:"input",type:"datetime-local"},{label:"Price",name:"price",as:"input",type:"number"},{label:"Location",name:"location",as:"input",type:"text"},{label:"Description",name:"description",as:"textarea"},{label:"Capacity",name:"capacity",as:"input",type:"number"},{label:"Video",name:"video",as:"input",type:"text"}];async function h(e,{setErrors:l}){try{const n={...e,...e.date&&{date:w(e.date).utc().format("YYYY-MM-DDTHH:mm:ssZ")},...e.price&&{priceInCents:e.price*100},price:void 0},i=Object.keys(n).reduce((g,d)=>(n[d]!==t.value[d]&&(g[d]=n[d]),g),{});if(!(Object.keys(i).length>0)){s.info("No changes to update");return}const{data:Y}=await f("/events/"+u.eventId,i,{method:"PATCH",headers:{"Content-Type":"application/merge-patch+json"}});t.value=Y,s.success("Event updated")}catch(n){if(G(n)){const i=z(n);return l({...i,price:i.priceInCents})}s.error("something went wrong")}}const N=()=>h({isPublished:!0},{setErrors:null}),T=()=>h({isPublished:!1},{setErrors:null}),V=y(()=>({...t.value,date:w.utc(t.value.date).local().format("YYYY-MM-DDTHH:mm"),price:t.value.priceInCents/100}));function q(){v.value.value=null,o.value=null}async function E(){try{if(!o.value){s.info("No image to update");return}const e=new FormData;e.append("cover",o.value);const{data:l}=await f("/update_cover/"+u.eventId,e,{method:"POST"});t.value=l,v.value.value=null,o.value=null,s.success("Image updated")}catch{s.error("something went wrong")}}return(e,l)=>{const n=U("router-link");return b.value?C("",!0):(r(),c("section",R,[Z,k(n,{to:`/theater-group/${u.theaterGroupId}/events`},{default:j(()=>[A(" Back ")]),_:1},8,["to"]),a("div",J,[a("img",{src:_(D),alt:"event cover"},null,8,K),a("div",Q,[a("input",{type:"file",ref_key:"coverInput",ref:v,onChange:l[0]||(l[0]=i=>o.value=i.target.files[0])},null,544),o.value?(r(),c("div",W,[B(a("button",{onClick:E},"Update",512),[[L,o.value]]),a("button",{onClick:q},"Cancel")])):C("",!0)]),t.value.isPublished?(r(),c("div",X,te)):(r(),c("div",ae,se)),t.value.isPublished?(r(),c("button",{key:2,onClick:T,class:"bg-red-500 text-white"}," Mark as not published ")):(r(),c("button",{key:3,onClick:N,class:"bg-blue-500 text-white"}," Publish "))]),k(O,{fields:S,validationSchema:_(P),"initial-values":_(V),onSubmit:h},null,8,["validationSchema","initial-values"])]))}}};export{re as default};
