import{k as S,h as D,r as f,o as V,g as y,n as k,p as s,L as E,M as v,q as G,C as N,a as u,c as l,m as p,D as b,f as x,b as r,l as B,x as F,F as L,H as T,t as j,N as M,y as O,z as P}from"./index-8538187a.js";import"./day-38c63f0d.js";const z=r("h1",{class:"text-xl"},"Events",-1),H=r("h2",null,"Events",-1),J={__name:"Events",props:{theaterGroupId:{type:String,required:!0}},setup(i){const d=i,c=S(),_=D(),m=f([]),g=f(!0);V(async()=>{try{const{data:a}=await y("/theater_groups/"+d.theaterGroupId+"/events");m.value=a["hydra:member"]}catch{c.error("something went wrong")}finally{g.value=!1}});const w=k({name:s().min(3).max(255).required(),date:E().required(),price:v().min(0).max(200).required(),location:s().required(),description:s().max(2e3).required(),cover:G(),video:s().matches(/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(\S+)?$|^$/,"The url is not a vid youtube url"),capacity:v().min(1).max(1e3).required()}),$=[{label:"Name",name:"name",as:"input",type:"text"},{label:"Date",name:"date",as:"input",type:"datetime-local"},{label:"Price",name:"price",as:"input",type:"number"},{label:"Location",name:"location",as:"input",type:"text"},{label:"Description",name:"description",as:"textarea"},{label:"Cover",name:"cover",as:"input",type:"file"},{label:"Video",name:"video",as:"input",type:"text"},{label:"Capacity",name:"capacity",as:"input",type:"number"}];async function C(a,{setErrors:h}){try{const e=new FormData;Object.entries(a).forEach(([n,o])=>{if(o){if(n==="date"){const I=M(o).utc().format();return e.append(n,I)}return n==="price"?e.append("priceInCents",o*100):e.append(n,o)}});const{data:t}=await y("/events",e,{method:"POST"}),q=t["@id"].split("/").pop();_.push(`/theater-group/${d.theaterGroupId}/event/${q}`)}catch(e){if(O(e)){const t=P(e);return h({...t,price:t.priceInCents})}if(e.status===403)return c.error(e.data["hydra:description"]);c.error("Something went wrong!")}}return(a,h)=>{const e=N("router-link");return u(),l("section",null,[z,p(e,{to:`/theater-group/${i.theaterGroupId}`},{default:b(()=>[x("Back")]),_:1},8,["to"]),r("div",null,[p(F,{"validation-schema":B(w),fields:$,"on-submit":C},null,8,["validation-schema"]),r("div",null,[H,r("ul",null,[(u(!0),l(L,null,T(m.value,t=>(u(),l("li",{key:t.id},[p(e,{to:`/theater-group/${i.theaterGroupId}/event/${t["@id"].split("/").pop()}`},{default:b(()=>[x(j(t.name),1)]),_:2},1032,["to"])]))),128))])])])])}}};export{J as default};
